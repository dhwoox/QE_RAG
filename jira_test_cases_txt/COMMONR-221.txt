■ 이슈 키: COMMONR-221
■ 제목: 장치 - Data Encryption (Credential&PIN Hash Key) Key & 암호화 레벨 3(GDPR) Support (사양 변경으로 제외 예정)
■ 설명: 1. FirmWare Version에 따른 Data Encryption Key 구분
 > 2020 1H 이전 : Data Encryption (Credential Key) == PIN Hash Key 
 > 2020 1H 이후 : Data Encryption (Credentila Key) == PIN Hash Key Or Data Encryption (Credential Key) =/=PIN Hash Key

3. 요구 사항
 1. 기기에서는 DB 암호화 Key로 지문 및 이름 암호화
 2. DB 암호화 Key로 해쉬된 PIN 값을 각 기기에서 저장
 > Default : Global 키로 해쉬된 PIN 값을 각 기기에서 저장 
 3. 매번 접속 시 마다 BioStar와 연결 시 암호화 Key 교환
 > 전제 조건 : SSL 사용 설정
 > Data 암호화 Option 설정 UI 제공
 > Data 암호화 미설정 시 기존 방식으로 동작
 *{color:#d04437}: On -> Off : Default Key로 설정이 되며 동작이 되도록(Secure Tamper : Data 암호화 사용안함에서 사용함으로 변경 시에만 On됨)
 : Off : Default Key로 설정이 되며 동작이 되도록 (Secure Tamper : Data 암호화 사용안함으로 변경 시에 이전 상태가 On이면 On 유지)
 : Off : Device의 암호화 Key가 다른 경우에는 Default Key 설정 되면서 사용자 삭제, 보안 키 과정 동작{color}*
 {color:#14892c}Default Key
 > Device - Server 용 Default Key 전송 시 Device에서 Server의 Key를 판단하여 Device Default Key로 인식
 > BioStar - Device 용 Default Key 전송 시 BioStar에서는 Device의 Key를 판단하여 Server Default Key로 인식{color}
 > Data 암호화 설정 시 사용자가 직접 Key를 입력 {color:#14892c}하도록 UI가 출력되어야 함.{color}
 : 입력 범위 : AES 256bit, 32byte
 : Device : SE 사용 장치 - AES 128bit로 Key저장, AES 256bit로 Data 암호화, 32byte / Flash 사용 장치 - Key 암호화 없이 저장, AES 256bit로 Data 암호화, 32byte
 : BioStar : 아래 1)~3)구현은 SW개발 2차에 진행(BSPP-312)
                  1) Data 암호화 키는 32자이내 Alphabet+Number+특수문자를 입력받을 수 있음 (최소 입력 값은 정리 필요)
                  2) 사용자가 32자보다 적게 입력할 경우 서버마다 Random Key를 생성하여 부족한 입력을 Random Key로 채워서 32자를 저장 함
                  3) Random Key는 암호화키 파일에 저장 됨 (\BioStar 2(x64)\util\enckey)
                  4) 위 32자이내 암호화 키 입력 지원을 하지 않을 경우 고객이 암호화 키를 확인할 수 있는 UI제공
 4. Data 암호화 Option 설정 변경 동작 
 {color:#d04437}> Secure communication with device는 1번 사용자만 보이고 업데이트가 가능하다. (DB Migration시 Login PW를 유지할 수 없고 다시 설정해야 하기 때문){color}
 {color:#14892c}> Data 암호화 Key 설정 시 DB에 저장된 개인정보 및 Credential 정보를 설정한 암호화 Key로 암호화 진행한다. 이 때 서버는 중지되고 DB Migration 완료 후 서버가 실행되고 장치와 연결되면 Data암호화 키를 전송한다. (장치의 암호화 키 변경되면 장치의 저장된 사용자 정보는 모두 삭제되며 이후 서버의 User Sync 옵션에 따라 사용자를 Sync한다.){color}
 {color:#d04437}> Data암호화 Key변경으로 DB Migration시에 사용자 정보 중 불가역 암호화인 PIN, Login Password는 모두 삭제된다.{color}
 {color:#14892c}> Data암호화 Key설정을 '사용'<->'사용 안 함' 변경 또는 Data암호화 키를 변경 시에도 위와 같이 DB Migration을 진행하며, 완료 후 변경된 암호화 Key를 장치에 전송한다.{color}
 {color:#14892c}> DB Migration이 진행 중인 경우에는 연결 전 까지 정상 동작은 못한다. {color}
 {color:#d04437}> 암호화키 설정/변경 시에 1번 사용자의 Password를 다시 설정하도록 암호화키 설정 부분에 출력된다. (Login PW도 불가역 암호화이기 때문에 다시 설정해주어야 함){color}
    {color:#d04437}: 1번 사용자(Administrator)의 Login PW의 설정 조건은 설정>서버>비밀번호 레벨에 따라 설정이 가능해야 한다.{color}
 {color:#14892c}> 불가역 암호화(SHA-256) 적용, PIN 정보는 키 변경시에는 유지 되지 않음{color}
 > Tamper On 발생 시 사용자, 로그, Data 암호화 키(SE, Flash 상의 개인정보 암호화/SSL 인증서 암호화 Key) 삭제 ({color:#333333}Secure Tamper{color}) {color:#14892c}(Data 암호화 설정 시 'Secure Tamper(Tamper On발생 시 사용자, 로그, Data 암호화 키 삭제 옵션)'는 항상 활성화되며 사용자가 비활성화로 변경 할 수 없음{color})
 > Data 암호화 Key가 유출된 경우 BioStar와 장치는 아래와 같이 동작 해야 한다.
 : BioStar : 서버를 중지하고, 별도의 유틸리티로 DB에 저장된 개인정보 및 Credential 정보를 새로운 Key로 암호화 진행함 (기존 Key와 신규 Key값 모두 필요)
 : Device : 사용자, Key(SE 저장된)등 모든 설정은 공장 초기화(SSL 인증서 삭제 시 방식으로)을 수동으로 진행하여 삭제가 되게 하고, 이후 장치는 Default Key로 동작 하다가, BioStar에 연결이 될 때 새로운 Key를 교환 하여 암호화 진행함
 : Reset All(설정 초기화) : SE내 Key 유지
 : Secure Element를 지원하는 장치는 SE에 Key를 저장하고, 미지원 하는 장치는 Flash에 저장

5. 예외 사항 - Data 암호화 다른 경우 동작 조건
{panel:title=예외 사항}
||BioStar Version||FirmWare Version||동작||
|V2.6 이하|New|새장치인 경우 Global Key로 동작, 다른 서버에 연결하여 사용한 경우 SSL 인증서로 인해 Factory Default 후 연결 동작|
|V2.6 이상|Old|V2.5에 추가된 FW Upgrade Alert에 의해 Upgrade 유도 : Upgrade 안 한 경우는 정상 동작을 보장 못함을 공지(Guide 문서, Help 기재 필요)|
|V2.6 이상|New|협의 후 추가 예정|
{panel}
6. 공유된 Data 암호화 Key로 Export / Import 동작
 7. 장치를 뜯어간 경우 Tamper On 발생으로 Data 암호화 Key를 삭제하여 Global Key로 동작하게 하여 Site별로 보안을 강화
 8. SSL 인증서 삭제, 공장 초기화 시 Data 암호화 Key도 같이 삭제 
 9. 통신 암호화 키 : 기존 방식 유지
 10. Data 암호화 키 항목 : Finger/Face Template, PIN
 11. SDK에서는 Key를 직접 입력할 수 있는 기능 제공
 12. DB 내의 Template만 별도의 Tool을 이용하여 확인 할 수 있도록 기존 Tool에 복호화 기능 추가
 13. BioStar 신규 설치 시, 설정 기본값은 미사용
 14. 장치 추가 시 아래와 같이 Data암호화 설정이 서버와 다를 경우, 알림팝업(사용자정보 삭제 됨을 Noti)이 출력되면서 서버와 동일한 Data암호화 Key로 설정되며 장치 추가 됨
      > 서버 : 장치와 보안 통신 사용, Data 암호화 사용
         1) 인증서 없는 장치 추가 > 알림팝업 발생되며 인증서 및 암호화 설정되며 장치 추가 됨
             : Old Version인 경우 : SSL에 대해서 Global Key로 동작을 하고, 암호화에 대해서는 Not Supported로 무시하여 동작에 대해서는 이전 처럼 동작이 되며, 장치는 추가가 되고, FirmWare Upgrade Alert이 발생 {color:#333333}(검증 필요){color}
 {color:#333333}         2) 동일 인증서, Data암호화 미설정 또는 다른 장치 추가 > 알림팝업 발생되며 Data암호화 Key가 서버와 동일하게 설정되며 장치가 추가 됨{color}
 {color:#333333}             : Old Version인 경우 : SSL에 대해서 Global Key로 동작을 하고, 암호화에 대해서는 Not Supported로 무시하여 동작에 대해서는 이전 처럼 동작이 되며, 장치는 추가가 되고, FirmWare Upgrade Alert이 발생 (검증 필요){color}
      > 서버 : 장치와 보안 통신 사용, Data 암호화 사용 안 함   
         3) 동일 인증서, Data암호화 설정 장치 추가 > 알림팝업 발생되며 서버가 Data암호화 설정되지 않았음으로 장치의 Data암호화 Key삭제되고 장치 추가 됨
      > 장치 추가 시 알림팝업은 장치 추가 수만큼 출력되는 것이 아니라 Action 수로 출력 됨(장치 100대 선택 후 Add버튼을 눌렀을 때 1번 알림 팝업 발생)
     {color:#d04437} > Advanced Search와 Waiting Device로 장치 추가시에는 항상 알림 팝업이 발생된다. (Data암호화 키가 동일하여도 알림팝업이 출력){color}
 15. 연결된 장치가 Disconnected상태에서 Data암호화 변경이 동작 되며, 추후 Disconnected장치가 연결되었을 때에 해당 장치에 Data암호화 변경 설정이 반영되어 사용자가 전체 삭제됨 (이 때, 별도로 알림 팝업은 발생되지 않음)

{color:#14892c}16. 고의 또는 실수에 의한 암호화 Key 유출로 암호화 Key변경이 필요한 경우를 위해 별도의 유틸리티 제공하여 DB에 저장된 개인정보 및 Credential 정보를 새로운 Key로 암호화 하도록 지원한다. 해당 유틸리티는 BioStar Package에 포함되어 배포되어야 한다. 기존 key와 신규 key값 모두 필요{color}

{color:#14892c}17. DB의 유출에 대비하는 암호화이므로 암호화 Key는 DB가 아닌 다른 곳에 저장될 수 있도록 지원 필요 함 > 설치 시 폴더안에 파일로 저장 됨{color}

{color:#14892c}18. DB백업 후 BioStar 재설치하여 DB복원 시 암호화 Key가 필요하기 때문에 고객은 DB백업 시 암호화 Key도 백업될 수 있도록 안내가 필요하다.{color}
       {color:#14892c}> 처음 Data 암호화 설정 시, 고객에게 암호화 Key가 저장되는 장소 및 DB를 백업하고 복원 시 해당 암호화키가 필요하고 암호화키가 삭제/분실하면 DB의 Data를 정상적으로 사용할 수 없다는 것을 알려줄 필요가 있음 (팝업 메시지를 통해 고객에게 인지 시킴, 메뉴얼에 해당 내용 및 백업및 복원방법에 대해서 기술 필요){color}

4. Data 암호화 보안 수준(GDPR) 적용 및 암호화 단계
 > 1 단계 - SSL, Data 암호화 미사용
 > 2 단계 - SSL, Data 암호화 사용
 > 3 단계 - SSL, Data 암호화 사용, Data 암호화 보안 수준 지원 사용
 > Data 암호화 보안 수준 지원 - 사용 안함(Default)/사용

*단계별 암호화 항목
 > 2 단계 (SSL, Data 암호화 사용)
 * 서버 : 지문, 얼굴, PIN, PW
 * 장치 : 지문, 얼굴, PIN, 이름

> 3 단계 (1단계 포함, SSL, Data 암호화 사용, Data 암호화 보안 수준 지원 사용)
 * 서버 : 이름, Email 주소, 전화번호, 사용자 ID, 카드 ID, 프로필 이미지, 로그(사용자 ID 컬럼만), 이미지 로그(비디오 로그는 미포함)
 * 장치 : 사용자 ID, 카드 ID, 프로필 이미지, 로그 (범위 확인 필요)

> 참고 : 암호화로 인해 암호화 항목 부분 검색 미지원 (이름, 사용자 ID, 카드 ID) 및 사용자 페이지 정렬 미지원 (컬럼 선택 시, 미지원 관련 팝업 구현 필요)

5. Data 암호화 보안 수준(GDPR) 사용 시 동작 - 장치
 > User, Log Delete All (로그 관련 수동 삭제 미지원) : Data 암호화 보안 수준(GDPR) 사용 -> 미사용 변경 시 , Data 암호화 보안 수준(GDPR) 미사용 -> 사용 변경 시 
 > Log 관련 암호화 구현 필요(GDPR 미사용 관련 - 이전 동작 방식으로 암호화 안함, GDPR 사용 시에만)
 {color:#59afe1}개인 정보 관련 로그만 해당 (User ID(Card ID), 인증, 등록, 편집, 삭제 등등){color} - 이상민 수석님 정리 필요
 > USB Export / Import 시 Config 파일에 GDPR 사용 관련 구현 필요 - {color:#d04437}*Data 암호화 키 설정 처럼 문구 팝업 구현 필요*{color}
 > USB Export / Import 시 버전간 호환성 확보(Old Version(User Export) -> New Version(User Import)), 하위 호환성 미지원
 > GDPR 적용된 장치간 USB Export / Import 미지원 : 해당 팝업 문구 구현 필요
 > 기간 별로 장치의 로그 삭제 시 : 해당된 기간 내의 로그 삭제, 군데 군데 발생한 로그는 미지원(시간 역전으로 발생한 로그 고려 안함)
 > GDPR 설정 유무 상관 없이 User ID관련하여 등록된 Last User ID+1로 동작함

6. Data 암호화 보안 수준(GDPR) 사용 시 동작 - 서버
 BioStar2 상세 기획 내용 (요구사항_BSPP-372_Data 암호화 레벨 지원_v0.9.pptx 반영) :
        1. 시스템 보안
            1) 글로벌 설정에 시스템 보안 메뉴 출력
            2) 시스템 보안은 아래와 같이 세부 옵션 항목 출력
                 > 로그인 비밀 번호 (BSPP-400 사양)
                 > 암호화 보안 설정
            3) 2.7.0부터는 서버의 고급 보안 설정은 출력되지 않음 : 해당 옵션은 시스템 보안에서 구현 됨
            4) 시스템 보안 메뉴 권한은 '전체 관리자'만 출력 및 접근 가능 ('설정'권한이 있는 커스텀관리자는 해당 메뉴 출력되지 않음)
        2. 로그인 비밀 번호 설정 : BSPP-400에서 요구사항 정리
        3. 암호화 보안 설정 및 동작
            1) 암호화 보안 설정에는 암호화 레벨 설정을 할 수 있음
                 : 암호화 레벨은 1단계, 2단계, 3단계 설정 가능
            2) 암호화 레벨 1단계 설정
                 : 암호화 보안 설정의 기본 값은 1단계
                 : 1단계는 서버내 사용자 지문, 얼굴 템플릿, PIN, PW 암호화 됨 (UI상 암호화 되는 정보 문구 출력)
                 : 2.7.0 이전 버전에는 'Data암호화 설정'을 사용하지 않을 경우 지문/얼굴 데이터를 암호화 하고 있지 않음, 2.7.0으로 업그레이드 시에 지문/얼굴 데이터를 암호화해서 저장할 수 있도록 Migration작업 필요
            3) 암호화 레벨 2단계 설정
                  가. 2단계는 1단계 암호화 적용, 서버와 장치 통신 TLS 1.2 적용 및 개별 암호화 키 적용 (UI상 암호화 되는 정보 문구 출력)
                  나. 2단계 설정 시 아래와 같이 하위 옵션 출력
                        > 서버 및 장치 암호화 키 수동 관리
                           -. 암호화 키 수동 관리 기본값 : 사용 안 함
                           -. 암호화 키 수동 관리 사용
                               : 이전버전 처럼 경고 팝업 출력 
                               : 이전버전 처럼 사용자 정보 중 PW/PIN 설정되어 있으면 '사용'으로 설정 불가(이전과 같이 경고 팝업 출력)
                               : 이전버전 처럼 사용 설정 시 '암호화 키' 설정 옵션이 출력 됨 
                               : 이전버전 처럼 '암호화 키'설정 및 동작은 동일 함
                       > 외부 인증서 사용
                           -. 이전버전 처럼 외부 인증서 사용 동작은 동일 함
                  다. 2.7.0 업그레이드 전에 '고급 보안 설정'에서 '장치와 보안 통신', '외부인증서 사용', '서버및 장치 암호화 키 수동 관리'을 사용하고 있다면 업그레이드 후 해당하는 옵션에 맞게 출력
                       > '장치와 보안 통신'을 사용하고 있었다면 2단계로 출력 됨
                       > '외부 인증서 사용'이 사용 상태였을 경우 '외부 인증서 사용'이 '사용' 상태로 출력 됨
                       > '서버 및 장치 암호화 키 수동 관리'가 사용 상태였을 경우 '서버 및 장치 암호화 키 수동 관리'가 '사용'으로 출력 되고 암호화 키 옵션도 출력 됨
                  라. 2단계 설정 시 경고 팝업 출력(이전버전에 '장치와 보안 통신'사용 시 출력되는 경고 팝업처럼 구현 필요)
                  마. 2단계 설정 시 미지원 장치(TLS 적용 불가 장치)가 있을 경우 경고 팝업 출력 및 설정 불가 (이전 버전에서 '장치와 보안 통신' 설정 동작과 동일하게 처리)
                  바. 2단계 설정 시 연결이 해제된 장치가 있을 경우 경고 팝업 출력 및 설정 불가 (이전 버전에서 '장치와 보안 통신' 설정 동작과 동일하게 처리)
                  사. 2단계 설정 상태에서 1단계로 변경 시 연결이 해제된 장치가 있을 경우 경고 팝업 출력 및 설정 불가 (이전 버전에서 '장치와 보안 통신' 설정 동작과 동일하게 처리)
           4) 암호화 레벨 3단계 설정
                  가. 3단계는 서버 및 장치 암호화 대상 확대 적용 됨 :
                       > 이름, Email, 전화번호, 사용자ID, 카드ID, 프로필이미지, 로그(사용자ID컬럼만), 이미지로그(비디오 로그는 미포함) 암호화 (UI상 암호화 되는 정보 문구 출력), Audit Trail
                  나. 3단계 설정 시 2단계와 동일하게 하위 옵션 출력고, 서버 및 장치 암호화 키 수동 관리는 자동 활성화 됨(활성화만 지원)
                       > 서버 및 장치 암호화 키 수동 관리 : 3단계로 설정 시 암호화 키 수동관리는 활성화로 변경되며, 비활성화로 변경할 수 없음(3단계는 암호화 키 수동관리를 사용해야 함)
                       > 외부 인증서 사용 : 2단계와 동일하게 동작
                       > 암호화 키 : 2단계와 동일하게 동작
                  다. 3단계 설정 시 경고 팝업 및 제약사항 동작
                       > 1단계에서 3단계로 설정 시 :
                             -. 경고 팝업 창 내용에 '장치와 보안 통신 사용'시 출력되는 경고 팝업 문구
                             -. 3단계에서 제약 사항(USB Import/Export, 부분검색 및 정렬 미지원, User ID자동증가 미지원)에 대한 경고 문구
                             -. 암호화키 수동 관리 활성화 시 출력되는 경고 팝업 및 제약 사항에 따른 설정 불가 처리 필요
                                   : 1단계에서 사용자에 PW/PIN설정되어 있으면 '3단계'설정 불가
                             -. 3단계설정 후 하위 단계로 설정 불가 내용
                       > 2단계에서 3단계로 설정 시 :
                            -. 경보 팝업 창 내용에 3단계에서 제약 사항에 대한 경고 문구 출력
                            -. 암호화키를 사용하고 있지 않으면 암호화키 수동 관리 활성화 시 출력되는 경고 팝업 및 제약 사항에 따른 설정 불가 처리 필요
                                  : 2단계에서 암호화키 수동관리를 사용하지 않고 PW/PIN설정되어 있으면 '3단계'설정 불가  
                            -. 3단계설정 후 하위 단계로 설정 불가 내용
                  라. 3단계 설정 후 저장 시, 암호화 대상 확대 적용을 위해 서버는 Migration을 수행 함
                  마. 3단계 설정 시, 암호화 3단계 미지원FW장치가 존재 시 에러 처리는 하지 않음, 해당 장치는 2단계로 동작 될 것 임 
                       > 이외 2단계 설정처럼 장치관련 에러 처리 동일 : TLS미지원장치, 연결이 해제된 장치
                  바. 3단계를 설정하여 사용 중 단계를 변경(1단계 또는 2단계) 시,  하위 단계로 변경하지 못하도록 경고 팝업 출력(3단계에서는 하위 단계로 변경이 불가)
                  사. 3단계 설정 시 USB Import/Export 미지원
                       > 비활성화 처리 또는 해당 옵션 출력되지 않도록 구현되어야 함
                  아. 3단계 설정 시 부분 검색 및 정렬 미지원
                       > 이름, 사용자ID, 카드 ID, Email 관련 부분 검색 및 정렬 미지원
                           -. 관련된 메뉴 : 사용자 메뉴, 사용자 등록 시 카드 할당, 출입통제 메뉴의 상태, 모니터링 메뉴, 근태관리 메뉴, 설정의 카드, 장치의 관리자
                  자. 3단계 설정 시 User생성하면 ID 자동 증가 기능 사용 불가

7. 지원 장치 및 버전 (추후 수정 예정)
{panel:title=지원 장치}
||장치||버전||일정||
|BS2|V1.7.0|2018 하반기|
|A2|V1.6.0|
|CS 40|V1.2.0|
|P2|V1.2.0|
|L2|V1.4.0|
|N2|V1.1.0|
|W2|V1.3.0|
|FS2|V1.2.0|
{panel}
{panel:title=미지원 장치}
||장치||버전||
|Entry|V2.x|
|정규등록V2.x|Old Version|
{panel}
8. 확인 필요
 > 인증서 및 Data 암호화 Key 변경 시 장치 재부팅 관련하여 재부팅 없이 가능한 해당 기능이 동작 하도록 구현 필요
 > 암호화 범위 관련하여 AES 128bit, AES 256bit등 현재 FW에서 설정된 ATEAS132(PN5180, CRLC663) 범위 확인 필요
============================================================

■ 테스트 스텝

[Step 1]
스텝 (Step)
1. Setting > Security > Advanced Security Settings > Secure Communication with Devcie > Not Use Or Use 
2. Device Hash Key Management > Not Use
3. 지원 장치 추가 / 기연결 상태

* 미지원 장치
> 최신 버전 Upgrade 필요

데이터 (Data)
BioStar - Default Key 설정(Data 암호화 초기)
> Secure Communication with Device : Not Use Or Use
> Device Hash Key Management : Not Use

예상 결과 (Expected Result)
1. BioStar에서 Secure Communication with Device/Device Hash Key Management : Not Use 인 경우는 Default Key로 동작이 되어 BioStar에 연결된 모든 장치에 대해서 기존 처럼 동작이 되어야 한다.
> Secure Tamper : Off 유지 
2. Secure Communication with Device/Device Hash Key Management : Use인 경우 사용자가 수동으로 변경시 Data 암호화 Key가 변경이 되면 안된다.
> BioStar 이용하여 Setting에서 Hashkey Management을 사용안함으로 변경 전까지 장치나 BioStar의 Device 상세 정보를 통해 변경 시 변경 불가
> Hashkey 입력을 안한 경우 적용이 안되고, 입력 화면 유지
------------------------------------------------------------
[Step 2]
스텝 (Step)
0. Setting > System Security> 암호화 레벨 2단계 설정
1. Setting > Security > Advanced Security Settings > Secure Communication with Devcie > Use
2. Device Hash Key Management > 기본 Key가 아닌 임의의 32자 Key 입력 
3. 지원 장치 추가 / 기연결 상태

데이터 (Data)
BioStar
> Secure Communication with Device : Use
> Device Hash Key Managementt : Use
> Device Hash Key 범위 
: Max - 32자이내 Alphabet+Number+특수문자
: 32자 보다 적은 경우 Full Length 32자를  입력하도록 팝업 발생

예상 결과 (Expected Result)
1. BioStar에 연결된 모든 장치에 대해서 Secure Tamper가 On으로 변경 되면 안된다.
> 변경 시 장치 재부팅이 안되는 지 확인
> Default : Off
> 사용자가 수동으로 On/Off
2. Secure Communication with Device/Device Hash Key Management : Use인 경우 변경이 되면 안된다.
> BioStar 이용하여 Setting에서 Data Encrypton을 사용안함으로 변경 전까지 장치나 BioStar의 Device 상세 정보를 통해 변경 시 변경 불가
3. Hashkey에 의해서 인증서,Hashkey가 장치에 설정 되고, 기존 장치의 사용자,로그는 모두 삭제 된다.
> Auto User Sync 설정 유무 상관 없이 사용자가 수동으로 사용자를 전송해야 하며, 사용자가 PIN은 삭제된 상태로 장치에 사용자는 PIN이 없는 상태로 출력됨
> BioStar Or Device에서 사용자를 추가하여 'Finger, Face, PIN' 정보를 입력 후 저장 후 출입 그룹및 인증 모드에 따라 인증 유무 발생 확인
4. 인증서(기본, 외부) 변경 시 Data 암호화 설정은 유지 된다.
> 인증서, Data 암호화 Key가 장치에서 삭제 되고, 기존 장치의 사용자, 로그가 삭제 되며, Default Key로 장치에 설정이 되면 안됨
------------------------------------------------------------
[Step 3]
스텝 (Step)
0. Setting > System Security> 암호화 레벨 2단계 설정
1. Setting > Security > Advanced Security Settings > Secure Communication with Devcie > Use
2. Device Hash Key Management > 기본 Key가 아닌 임의의 32자 Key 입력 
3. 지원 장치 추가 / 기연결 상태

데이터 (Data)
BioStar
> Secure Communication with Device : Use
> Device Hash Key Management : Not Use
> Data 암호화 키 범위 
: Max - 32자이내 Alphabet+Number+특수문자
: 32자 보다 적은 경우 Full Length 32자를  입력하도록 팝업 발생

예상 결과 (Expected Result)
1. BioStar에 연결된 모든 장치에 대해서 Secure Tamper가 Data 암호화 변경 전 상태가 On이면 On 유지하고, 이후 사용자가 수동으로 Off 변경 가능하다.
> 변경 시 장치 재부팅이 안되는 지 확인
> Data 암호화 On -> Off : Secure Tamper On 유지, 이후 사용자 변경 가능
2. Secure Communication with Device : Use  / Device Hash Key Management : Not Use인 경우 Data 암호화 Key에 의해서 인증서, Data 암호화 Key가 장치에서 삭제 되고, 기존 장치의 사용자, 로그도 삭제 되며, Default Key로 장치에 설정이 된다.
> Auto User Sync 설정 유무 상관 없이 사용자가 수동으로 사용자를 전송해야 하며, 사용자가 PIN은 삭제된 상태로 장치에 사용자는 PIN이 없는 상태로 출력됨
> BioStar Or Device에서 사용자를 추가하여 'Finger, Face, PIN' 정보를 입력 후 저장 후 출입 그룹및 인증 모드에 따라 인증 유무 발생 확인
------------------------------------------------------------
[Step 4]
스텝 (Step)
0. Setting > System Security> 암호화 레벨 2단계 설정
1. Setting > Security > Advanced Security Settings > Secure Communication with Devcie > Use
2. Device Hash Key Management> 기본 Key가 아닌 임의의 32자 Key 입력 
3. 지원 장치 추가 / 기연결 상태

데이터 (Data)
BioStar
> Secure Communication with Device : Use
> Device Hash Key Management : Use
> Data 암호화 키 범위 
: Max - 32자이내 Alphabet+Number+특수문자
: 32자 보다 적은 경우 Full Length 32자를  입력하도록 팝업 발생

예상 결과 (Expected Result)
1. BioStar에 연결된 장치 중 미지원 장치에 사용자 전송 시 장치에 설정된 Key로 Finger/Face를 암호화 하여 인증 유무 판단을 하고, PIN에 대해서는 인증 실패가 발생한다.
> FW Upgrade Alert에 의해 지원 버전으로 업그레이드 시 Data 암호화 Key가 설정이 되고, 출입 그룹 및 인증 모드에 따라 인증 유무 발생
> Secure Communication with Device/Device Hash Key Management : Use로 인해 Secure Tamper가 On으로 변경
> 반대의 경우도 동일하게 처리함
2. 동일 인증서에 다른 Key 장치는 사용자, 로그 삭제가 되고, 동일 Key로 설정 된다.
> 재부팅 미발생
------------------------------------------------------------
[Step 5]
스텝 (Step)
0. Setting > System Security> 암호화 레벨 2단계 설정
1. Setting > Security > Advanced Security Settings > Secure Communication with Devcie > Use
2. Device Hash Key Management > 기본 Key가 아닌 임의의 32자 Key 입력 
3. 미지원 장치 추가 / 기연결 상태
4. AOC/SCC 발급

데이터 (Data)
BioStar
> Secure Communication with Device : Use
> Device Hash Key Management : Use
> Data 암호화 키 범위 
: Max - 32자이내 Alphabet+Number+특수문자
: 32자 보다 적은 경우 Full Length 32자를  입력하도록 팝업 발생

예상 결과 (Expected Result)
1. BioStar에 연결된 장치 중 미지원 장치에 사용자 전송 시 장치에 설정된 Key로 Finger/Face를 암호화 하여 인증 유무 판단을 하고, PIN에 대해서는 인증 실패가 발생한다. (지원하는 장치도 Key가 다른 경우 동일)
> AOC : Card Only 제외하고, 출입그룹/인증 모드에 따라 인증 성공 유무 판단, PIN에 대해서는 인증 실패 
> SCC : PIN을 제외하고, 출입 그룹/인증 모드에 따라 인증 성공 유무 판단

> PIN Hash Key로 동작하는 2020 1H 이후 버전 부터는 PIN에 대해서도 정상 동작으로 변경
------------------------------------------------------------
[Step 6]
스텝 (Step)
0. Setting > System Security> 암호화 레벨 2단계 설정
1. Setting > Security > Advanced Security Settings > Secure Communication with Devcie > Use
2. Device Hash Key Management > 기본 Key가 아닌 임의의 32자 Key 입력 
3. 지원 장치 추가 / 기연결 상태

데이터 (Data)
BioStar
> Secure Communication with Device : Use
> Device Hash Key Management : Use
> Data 암호화 키 범위 
: Max - 32자이내 Alphabet+Number+특수문자
: 32자 보다 적은 경우 Full Length 32자를  입력하도록 팝업 발생

예상 결과 (Expected Result)
1. BioStar에 연결된 모든 장치에 대해서 Secure Tamper가 On으로 변경 되어야 한다.
> 변경 시 장치 재부팅이 안되는 지 확인
> Default : Off
2. Secure Communication with Device/Device Hash Key Management : Use인 경우 변경이 되면 안된다.
> BioStar 이용하여 Setting에서 Data Encrypton을 사용안함으로 변경 전까지 장치나 BioStar의 Device 상세 정보를 통해 변경 시 변경 불가
3. Data 암호화 Key에 의해서 인증서, Data 암호화 Key가 장치에 설정 되고, 기존 장치의 사용자, 로그는 모두 삭제 된다.
> Auto User Sync 설정 유무 상관 없이 사용자가 수동으로 사용자를 전송해야 하며, 사용자가 PIN은 삭제된 상태로 장치에 사용자는 PIN이 없는 상태로 출력됨
> BioStar Or Device에서 사용자를 추가하여 'Finger, Face, PIN' 정보를 입력 후 저장 후 출입 그룹및 인증 모드에 따라 인증 유무 발생 확인
4. 인증서(기본, 외부) 변경 시 Data 암호화 설정은 유지 된다.
> 인증서, Data 암호화 Key가 장치에서 삭제 되고, 기존 장치의 사용자, 로그가 삭제 되며, Default Key로 장치에 설정이 되면 안됨
------------------------------------------------------------
[Step 7]
스텝 (Step)
1. 암호화 레벨 2(통신 보안/Data 암호화) 사용
2. 지원 장치 추가 / 기연결 상태
3. 통신 보안만 사용 안함 변경

데이터 (Data)
BioStar
> Secure Communication with Device : Use -> Not Use
> Device Hash Key Management : Use
> Data 암호화 키 범위 
: Max - 32자이내 Alphabet+Number+특수문자
: 32자 보다 적은 경우 Full Length 32자를  입력하도록 팝업 발생

예상 결과 (Expected Result)
1. 통신 보안을 사용안함으로 변경 시 기존 Data 암호화(Hash Key)는 변경이 안되기 때문에 Hash Key로 동작 한다.
> 사용자, 인증서, Data 암호화 Key 유지
> 로그 - 유지(기존 사양 변경 - 유지)
------------------------------------------------------------
[Step 8]
스텝 (Step)
1. 암호화 레벨 2(통신 보안/Data 암호화)/암호화 레벨 3 사용
2. 지원 장치 추가 / 기연결 상태

데이터 (Data)
BioStar
> Secure Communication with Device : Use -> Not Use
> Device Hash Key Management : Use
> Data 암호화 키 범위 
: Max - 32자이내 Alphabet+Number+특수문자
: 32자 보다 적은 경우 Full Length 32자를  입력하도록 팝업 발생
> 암호화 레벨 3 : Use

예상 결과 (Expected Result)
1. 암호화 레벨 3(GDPR)를 사용함으로 변경 시 기존 2단계 설정에 암호화 대상만 추가가 되어 동작이 된다.
> 사용자, 로그 삭제
> 인증서, Data 암호화 설정
> Secure Tamper On 설정
2. 암호화 레벨 3(GDPR)을 사용안함으로 변경 시 단계 별 설정에 맞게 동작이 된다.
> 1차 - 사용자, 로그는 무조건 삭제
> 2차 - 암호화 레벨에 맞게 기존 처럼 동작
> 3차 설정 후 1차/2차로 변경 불가
------------------------------------------------------------
[Step 9]
스텝 (Step)
1. 암호화 레벨 2(통신 보안/Data 암호화)/암호화 레벨 3 사용
2. 지원 장치 추가 / 기연결 상태

데이터 (Data)
BioStar
> Secure Communication with Device : Use -> Not Use
> Device Hash Key Management : Use
> Data 암호화 키 범위 
: Max - 32자이내 Alphabet+Number+특수문자
: 32자 보다 적은 경우 Full Length 32자를  입력하도록 팝업 발생
> 암호화 레벨 3 : Use

예상 결과 (Expected Result)
1. 암호화 레벨 3(GDPR)를 사용함으로 설정한 경우의 기존 기능 중 일부 제약으로 동작 된다.
> USB Import/Export 미지원
------------------------------------------------------------
[Step 10]
스텝 (Step)
1. 설정> 시스템 보안> 장치와 보안통신: 사용 설정
2. 장치 해시키 수동 관리: 사용 설정
3. 장치 해시키 변경 후 확인

데이터 (Data)
장치 해시키 변경
> 데이터 암호화 키: 32자
> 관리자 암호화 키: BioStar 로그인PWD

예상 결과 (Expected Result)
1. 서버에서 Migration 된다.
2. 장치에서 DB 초기화가 되고, 서버에서 사용자를 재전송해야 한다.
> 장치 Reboot 미발생
------------------------------------------------------------
[Step 11]
스텝 (Step)
[장치 해시키 수동관리: 사용 상태]
1. 설정> 시스템 보안
2. 장치 해시키: 다른 key로 데이타 암호화 키 변경 후 확인

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. 서버에서 Migration 된다.
2. 장치에서 DB 초기화가 되고, 서버에서 사용자를 재전송해야 한다.
> 장치 Reboot 미발생
------------------------------------------------------------
[Step 12]
스텝 (Step)
[장치 해시키 수동관리: 사용 상태]
1. 설정> 시스템 보안
2. 장치 해시키 수동관리: 사용안함 으로 설정 변경
3. 관리자 암호입력 후 확인

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. 서버에서 Migration 된다.
2. DB 초기화되고, 장치 Reboot 발생된다.
3. Secure Tamper는 사용자에 의해서 수동으로 변경 가능 하다.
> On -> Off로
> Off -> On으로 
> 자동 설정 및 변경 불가 기능은 제외
------------------------------------------------------------
[Step 13]
스텝 (Step)
[이상민 수석님께 요청]
1. command 창에서 +2 Hash key 생성
2. 장치로 해당 Hash key 전송
3. 해당 장치 서버에 연결
4. PIN을 가지고 있는 사용자로 인증 시도.

데이터 (Data)
1. 서버는 기본값을 가지고 있는 상태
2. 장치에는 +2의 Hash Key가 내려가 있는 상태 : 이상민 수석님께 요청 필요하며 +2의 Hash Key는 서버와 통신할때 주고 받는 고유의 값을 말함.
3. 장치 인증모드
:Card+PIN
:Finger+PIN
:ID+PIN
4. BioStar2 v2.8.0 이후 버전 사용.

예상 결과 (Expected Result)
1. PIN을 가진 인증모드로 인증이 정상적으로 처리되어야 한다.
------------------------------------------------------------
