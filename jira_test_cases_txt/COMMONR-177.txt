■ 이슈 키: COMMONR-177
■ 제목: 통신 보안 - SSL/TLS
■ 설명: SSL/TLS 적용으로 통신 보안성 높임
> 기존 프로토콜을 유지한 채로 통신 연결부분만 SSL로 대체
> 대상 제품 : FS2, BS2, A2, L2, W2, P2, N2, CS40
                     ※ XPASS/XPS2는 사양변경으로 통신보안 미지원

장치 통신 보안 사용 유무(SSL 모드)
> Root 인증서 존재 유무로 판단(TLS Handshake : End User 인증서 서버로 부터 전달)
 루트 인증서 저장  : 통신 보안 모드 사용
 루트 인증서 삭제  : 통신 보안 모드 미사용, 공장 초기화

Root 인증서 관리
> 인증서 삭제 : 공장 초기화, 통신 보안 모드 미사용

공장 초기화
> UI 있는 장치 : Root 인증서 저장 상태에서 관리자 메뉴에 '공장 초기화' 표시 
> UI 없는 장치 : 네트워크 초기화 버튼으로 3회 입력되면 마지막 입력을 기다리는 모드로 진입하고 입력이 5초 이내에 발생 시 
   : 입력 대기 상태(LED) : Yellow LED 점멸
> '사용자', '로그', '설정' 모두 삭제
   : UI 있는 장치 : 확인창 출력
   : UI 없는 장치 : Device Viewer로 확인

Re-play 공격에 대한 방어
> Packet Sequence 검사 : TCP Packet Only
> Request Sender : TCP 연결 직후의 Time Tick을 초기값으로 Random한 Sequence 값을 만들고, 해당 값을 Packet의 Sequence로 전송
> Request Receiver : TCP 연결 직후 처음으로 수신한 Sequence를 저장하고, 이를 기준으로 다음 Packet의 Sequence 검사
============================================================

■ 테스트 스텝

[Step 1]
스텝 (Step)
[장치와 보안 통신: 사용]
1. Device> UDP Search> 인증서를 가지지 않은 장치추가

데이터 (Data)
장치의 네트워크 설정
> 고정IP / 유동IP

예상 결과 (Expected Result)
1. 장치 추가 시 Root 인증서가 서버로 부터 장치에 전송이 된 후 서버와 통신가능하다.
> 추가시 Disconnected로 동작 후 인증서 적용되면 Connected로 상태전환
------------------------------------------------------------
[Step 2]
스텝 (Step)
[장치와 보안 통신: 사용]
1. DEVICE > UDP Search> 장치를 서버모드로 설정변경
2. Wating Device 에 표시되는 장치추가

데이터 (Data)
장치의 네트워크 설정
> 고정IP / 유동IP

예상 결과 (Expected Result)
1. 장치 추가 시 Root 인증서가 서버로 부터 장치에 전송이 된 후 서버와 통신가능하다.
> 추가시 Disconnected로 동작 후 인증서 적용되면 Connected로 상태전환
------------------------------------------------------------
[Step 3]
스텝 (Step)
[장치와 보안 통신: 사용]
1. DEVICE > UDP Search
2. 서버와 동일한 인증서를 가진 장치추가

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. 장치 추가 시 정상적으로 추가가 된다.
------------------------------------------------------------
[Step 4]
스텝 (Step)
[장치와 보안 통신: 사용]
1. DEVICE > UDP Search
2. 서버와 상이한 인증서를 가진 장치추가시도

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. UDP Search의 경우 추가는 되나 Disconnected로 동작된다.
------------------------------------------------------------
[Step 5]
스텝 (Step)
[장치와 보안 통신:사용]
1. DEVICE > UDP Search> 서버와 동일한 인증서를 가진 장치에 대해 서버모드로 설정변경
2.Waiting Device에 표시 및 추가유무 확인

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. 장치 추가 시 정상적으로 추가가 된다.
------------------------------------------------------------
[Step 6]
스텝 (Step)
[장치와 보안 통신:사용]
1. DEVICE > UDP Search> 서버와 상이한 인증서를 가진 장치에 대해 서버모드로 설정변경
2.Waiting Device에 표시 및 추가유무 확인

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. 장치 추가 시 추가가 안된다.
> Waiting Device 미표시됨
------------------------------------------------------------
[Step 7]
스텝 (Step)
[장치와 보안 통신: 사용]
1. DEVICE > Search Device > Device 선택
2. SSL/TLS 미지원 FW 장치 추가시도

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. 장치 추가 시 장치 펌웨어의 미지원으로 추가가 안된다.
> 오류 팝업 발생
------------------------------------------------------------
[Step 8]
스텝 (Step)
[장치와 보안 통신: 사용]
1. DEVICE > Advanced Search로 타 서버 인증서를 가진 장치 추가시도

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. 장치를 찾을 수 없다는 오류 팝업 발생된다.
------------------------------------------------------------
[Step 9]
스텝 (Step)
[장치와 보안 통신: 미사용]
1. DEVICE > Search Device > Device 선택
2. 타 서버 인증서를 가진 장치 추가시도

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. 장치 추가불가하다.
------------------------------------------------------------
[Step 10]
스텝 (Step)
1. 서버에 장치추가
2. 장치와 보안통신 및 외부인증서 설정
3. 장치 Reboot여부 확인
4. Reboot 후 서버와의 연결상태 확인

데이터 (Data)
연결모드
> Server Mode
> Direct Mode

장치와 보안통신
> 사용

외부인증서
> 사용안함
> 사용

예상 결과 (Expected Result)
1. Reboot되지 않는다.
2. 장치 Reboot 후 서버와의 연결이 정상적으로 이루어진다.

※ 만약 Secure Tamper 설정에 의해 Tamper On이 발생하면 Database Reset이 되고, 이후 동작이 진행된다.
------------------------------------------------------------
[Step 11]
스텝 (Step)
1. 서버에 장치추가
2. 장치와 보안통신 및 외부인증서 설정
3. 장치의 연결모드 변경
4. 장치연결상태 확인

데이터 (Data)
연결모드
> Server Mode
> Direct Mode

장치와 보안통신
> 사용

외부인증서 사용
> 사용안함
> 사용

예상 결과 (Expected Result)
1. 변경된 설정적용 후 서버와의 연결이 끊어졌다가 재연결이 이루어져야 한다.
------------------------------------------------------------
[Step 12]
스텝 (Step)
1. 장치와 보안 통신 사용 설정
2. FirmWare Upgrade 시도

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. FW Upgrade가 정상적으로 이루어져야 한다.
------------------------------------------------------------
[Step 13]
스텝 (Step)
1. 장치와 보안통신 사용 설정
2. 장치 해시키 수동관리 사용 설정
3. FirmWare Upgrade 시도

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. FW Upgrade가 정상적으로 이루어져야 한다.
------------------------------------------------------------
[Step 14]
스텝 (Step)
[사용자 동기화: 모든장치 & 장치와 보안 통신: 사용]
1. 장치추가
2. Timeout 및 Reboot 유무 확인

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. 서버와 연결이 끊어지거나, 비정상적으로 재부팅이 발생하지 않아야 한다.
------------------------------------------------------------
[Step 15]
스텝 (Step)
[사용자 동기화: 모든장치 & 장치와 보안 통신: 사용 & 장치 해시키 수동관리: 사용]
1. 장치추가
2. Timeout 및 Reboot 유무 확인

데이터 (Data)
N/A

예상 결과 (Expected Result)
1. 서버와 연결이 끊어지거나, 비정상적으로 재부팅이 발생하지 않아야 한다.
------------------------------------------------------------
