■ 이슈 키: COMMONR-199
■ 제목: 인증 - Group Matching
■ 설명: *<소개>*
1:N 매칭의 최대 지원 Template 수가 작은 경우, 그룹을 먼저 선택하여 N에 해당하는 대상의 수를 줄이는 기능
고객 입장에서는 1:N 보다는 불편하나 1:1 보다는 편리하게 최대 지원 Template 수를 늘릴 수 있는 기능
*<요구사항>*
그룹 사용자 판단 기준
: 사용자 수가 아닌 얼굴 수로 판단
Max Group Face : 5000
: Max Support Group : 1 ~ 10
  Group Case
 (!) 3000 + 2000
 (!) 1000 x 5
 (!) 500 x 10
: Maximum number of faces per group : 3000 Face
설정
: 그룹 매칭 사용 여부를 설정
: 인증 모드 설정 화면에 '그룹매칭 사용' 설정 추가 필요, '사용안함' 이 기본값
: '사용안함'를 선택한 경우 전체를 대상으로 일반적인 얼굴 인증 시도
: '사용'을 선택한 경우 그룹 매칭으로 동작
사용자 정보에 그룹 추가
: 사용자 정보에 그룹 정보 추가 필요(한명의 사용자는 반드시 하나의 그룹에만 속함)
장치에 그룹 정보 추가
: 그룹정보는 ID 4Byte, 설명 48Byte 로 구성
: 장치당 최대 10개의 그룹 저장 가능
그룹 매칭 동작
: 사용자가 장치 앞에 위치했을 때, 그룹 선택 화면 팝업
: 그룹을 선택하면 해당 그룹의 얼굴 Template을 대상으로 바로 얼굴 인증 시도
: 인증 성공 시 팝업 표시 후 그룹 선택 화면으로 전환 
: 인증 실패 시 팝업 표시 후 그룹 선택 화면으로 전환

*<그룹매칭 설정 및 사용자 그룹 설정>*
1. 장치에서 사용자 등록 시에는 그룹매칭 그룹을 선택할 수 없다.
2. 사용자 상세 정보에서 해당 사용자에게 설정된 그룹매칭 그룹을 확인할 수만 있다.(변경 불가능)
3. 장치에서 그룹매칭 사용여부를 변경할 수 없고, 현재 그룹매칭의 사용여부를 확인할 수만 있다.
4. 그룹매칭 사용중에 장치에서 등록된 사용자는 BioStar 2나 SDK를 이용해서 매칭그룹을 설정한 후에 얼굴인증이 가능하다.
5. BioStar 2나 SDK를 이용한 그룹매칭 On은 등록된 사용자 수나 사용중인 인증모드에 관계없이 수행할 수 있다.
6. BioStar 2나 SDK를 이용한 그룹매칭 Off는 등록된 얼굴의 수가 3000개 이하거나 1:N을 지원하지 않는 경우에만 가능하다.

*<초기화 관련>*
1. 초기화가 진행되면 등록된 얼굴 수와 무관하게 그룹매칭은 Off로 설정된다.
(초기화 후에는 설정을 맞춰야 정상동작 가능)

*<관리자 메뉴 진입>*
1. 관리자 메뉴 진입은 그룹 매칭 사용 여부와 무관하게 '얼굴', '카드', 'ID + 지문/PIN' 으로 동작한다.(기존 사양과 동일)
2. 얼굴 등록 수가 3000개를 넘어 1:N 사용이 불가한 상황에서 메뉴 진입을 위해서 얼굴인증을 시도한 경우에는 '지원하지 않는 인증모드' 오류 메세지를 표시한다.
============================================================

■ 테스트 스텝

[Step 1]
스텝 (Step)
1. BioStar > Setting > Face Group Matching

데이터 (Data)
[BioStar]

예상 결과 (Expected Result)
1. Face Group을 추가할 수 있어야 한다.
------------------------------------------------------------
[Step 2]
스텝 (Step)
1. BioStar > Setting > Face Group Matching

데이터 (Data)
[BioStar]
# Group Matching
1. Not Use(기본값)
2. Use

예상 결과 (Expected Result)
1. 그룹 매칭 기능의 기본값은 사용안함이다.
2. 'Not Use'와  'Use' 중 한가지를 선택 할 수 있다.
3. 장치에선 그룹 매칭 사용여부에 대한 확인만 가능하다.
------------------------------------------------------------
[Step 3]
스텝 (Step)
1. BioStar > Setting > Face Group Matching > Group Matching : Not Use
2. 장치 메뉴 진입 > User > Face Group 확인

데이터 (Data)
[BioStar]
# Group Matching
1. Not Use(기본값)
2. Use

예상 결과 (Expected Result)
1. Use시 사용자의 정보에서 Face Group 표시는 되나 Face Group를 설정할 수 없다.
2. Not Use시 사용자 정보에서 Face Group 표시되지 않는다.
------------------------------------------------------------
[Step 4]
스텝 (Step)
1. BioStar > Setting > Face Group Matching > Apply

데이터 (Data)
[BioStar]
# Group Matching
1. Not Use(기본값)
2. Use
# Group Matching Device Settings
# Matching Group Settings

예상 결과 (Expected Result)
1. Face Group ID는 1~10까지 설정 할 수 있다.
2. Face Group 이름은 하기와 같이 작성할 수 있어야 한다.
한글 : 30글자
영대소문자 : 30자
숫자 : 30자
특수문자 : 30자
3. 장치에서 Face Group ID 확인시 설정값이 정상적으로 적용 및 표시되어야 한다.
4. 장치에서 Face Group 설정 확인시 설정값이 정상적으로 보여져야 한다.
------------------------------------------------------------
[Step 5]
스텝 (Step)
1. BioStar > Setting > Face Group Matching
2. Group Matcing > Group Matching Device Settings > Matching Group Settings > Apply

데이터 (Data)
[BioStar]
# Group Matching
1. Not Use(기본값)
2. Use
# Group Matching Device Settings
# Matching Group Settings
1. 최대 10개까지 생성 가능

예상 결과 (Expected Result)
1. Face Group는 최대 10개까지 생성 가능해야한다.

(on) Max Group Face : 5000 -> 4000 수정
: Max Support Group : 1 ~ 10
Group Case
 3000 x 1 + 2000 x 1 -> 3000 x 1 + 1000 x 1
 1000 x 5 -> 1000 x 4
 500 x 10 -> 400 x 10

(on) Warning
The total number of faces in the select user group hierachy exceeds the maximum 3,000 faces. (262157)
------------------------------------------------------------
[Step 6]
스텝 (Step)
1. BioStar > Setting > Face Group Matching > Matching Group Settings >  User Group 선택

데이터 (Data)
[BioStar]
# Group Matching
1. Not Use(기본값)
2. Use
# Group Matching Device Settings
# Matching Group Settings
1. 최대 10개까지 생성 가능

예상 결과 (Expected Result)
1. Face Group에 속하는 User Group는 그룹 당 최대 얼굴 수의 제한 전까지는 제한이 없다.
------------------------------------------------------------
[Step 7]
스텝 (Step)
1. BioStar > Setting > Face Group Matching > Matching Group Settings > User Group 중복 선택

데이터 (Data)
[BioStar]
# Group Matching
1. Not Use(기본값)
2. Use
# Group Matching Device Settings
# Matching Group Settings
1. Face Group A
2. Face Group B

각각에 동일한 User Group 설정

예상 결과 (Expected Result)
1. 동일한 사용자 그룹은 하나의 Face Group에만 속할 수 있다.

(on) Warning  
'The user group was already assigned to another matching group'
------------------------------------------------------------
[Step 8]
스텝 (Step)
[ Group Matching :  Use ]
1. FS2/FL Main 화면에서 얼굴 인증 시도한다.

데이터 (Data)
[Main UI]
FS2/FL Only

예상 결과 (Expected Result)
1. 설정한 Face Group을 선택할 수 있는 창이 표시되어야 한다.
> Motion Sensor에 의해 Face Group 선택 창 팝업
------------------------------------------------------------
[Step 9]
스텝 (Step)
[ Group Matching : Use ]
1. FS2/FL Main 화면에서 얼굴 인증 시도한다.
2. 해당 Face Group을 선택 > 인증시도

데이터 (Data)
[Main UI]
FS2/FL Only

예상 결과 (Expected Result)
1. 인증시도한 사용자가 해당 되어있는 Face Group 선택시 인증성공 되어야 한다.
2. '인증성공' 로그가 남아야 한다.
3. 인증성공 후 그룹 선택 화면으로 전환되어야 한다.
------------------------------------------------------------
[Step 10]
스텝 (Step)
[ Group Matching : Use ]
1. FS2/FL Main 화면에서 얼굴 인증 시도한다.
2. 미해당 Face Group을 선택 > 인증시도

데이터 (Data)
[Main UI]
FS2/FL Only

예상 결과 (Expected Result)
1. 인증시도한 사용자가 미해당 되어있는 Face Group 선택시 인증실패 되어야 한다.
2. '인증실패' 로그가 남아야 한다.
3. 인증성공 후 그룹 선택 화면으로 전환되어야 한다.
------------------------------------------------------------
[Step 11]
스텝 (Step)
[ Group Matching : Use ]
1. 장치에서 임의의 사용자를 신규 등록한다.(Face 포함)
2. 얼굴 인증 시도한다.

데이터 (Data)
[BioStar]
# Group Matching
1. Use
# 신규 사용자(Face) 등록
1. FS2/FL 장치 이용

예상 결과 (Expected Result)
1. 얼굴(신규 등록 사용자) 인증 시도시 인증 실패 해야 한다.
------------------------------------------------------------
[Step 12]
스텝 (Step)
[ Group Matching : Use ]
1. 장치의 얼굴 인증모드를 '사용 안함'으로 설정한다.
2. 임의의 얼굴 사용자를 인증시도한다.

데이터 (Data)
[BioStar]
# Group Matching
1. Use
# 1:N 인증 모드 : 비활성화
1. FS2/FL > Authentication > Auth Mode : Face (x)

예상 결과 (Expected Result)
1. 그룹 선택 화면 미표시로 인해 얼굴 매칭 시도시 그룹 매칭이 동작하면 안된다.
2. Face을 제외하고 인증 성공이 되어야 한다.
> Private Auth(1:N Face) : 미지원
------------------------------------------------------------
[Step 13]
스텝 (Step)
[얼굴 사용자 4000명 미만]
1. BioStar > Setting > Face Group Matching > Group Matching : Use
2. BioStar > Setting > Face Group Matching > Group Matching : Not Use 변경

데이터 (Data)
[BioStar]
# Group Matching
1. Use -> Not Use

예상 결과 (Expected Result)
1. Face Group Matching Off가 불가능하다.

(on) Warning 
1:1 인증모드가 설정 되어 있지 않습니다. 인증모드 변경 후 제거하십시오
------------------------------------------------------------
[Step 14]
스텝 (Step)
[얼굴 사용자 4000명 초과]
1. 장치 인증모드 얼굴 인증모드 '사용 안함'
2. BioStar > Setting > Face Group Matching > Group Matching : Use
3. BioStar > Setting > Face Group Matching > Group Matching : Not Use 변경

데이터 (Data)
[BioStar]
# Group Matching
1. Use -> Not Use

예상 결과 (Expected Result)
1. Face Group Matching Off가 가능하다.
------------------------------------------------------------
[Step 15]
스텝 (Step)
1. BioStar > Device > Factory Default 시도한다.
 1) 얼굴 사용자 4000명 미만
 2) 얼굴 사용자 4000명 초과

데이터 (Data)
[BioStar]
# Group Matching
1. Use
# Group Matching Device Settings
# Factory Default
> Reset

예상 결과 (Expected Result)
1. Face Group Matching Off로 설정된다.
> Device
------------------------------------------------------------
