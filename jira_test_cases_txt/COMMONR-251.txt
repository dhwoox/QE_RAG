■ 이슈 키: COMMONR-251
■ 제목: [BSPP-413] [Device User Enroll] 중복 지문/얼굴/카드 검사
■ 설명:  * 장치
 ** LCD 있는 장치에서 메뉴로 중복 검사 지원 (Default는 활성화)
 => 중복 검사 메뉴 위치 및 용어 {color:#d04437}(추후 변경 가능){color}
 > Face 계열 : Authentication > Face > 중복 검사(Duplicate Check)
 > Finger 계열 : Authentication > Fingerprint > 중복 검사(Duplicate Check)
 => 중복 검사 기본값 {color:#d04437}(추후 변경 가능){color}
 > 장치 UI에 따라 활성화 의미로 Enabled, !Enabled.png|align=absmiddle,thumbnail!
 ** 지문, 얼굴 등록시 중복 검사 후, 이미 등록된 지문, 얼굴이 있을 경우, 등록 실패 및 Matching 되는 User ID 표시, 단 동일 사용자에 중복으로 지문, 얼굴 등록 시에는 중복 체크 안함, Max로 등록 카드
 {color:#d04437} => Card에 대해서 지문, 얼굴과 같이 동일하게 중복 검사 지원
 > 동일 사용자에 중복으로 카드(동일)를 등록하는 경우에는 기존 처럼 동작(미리 중복 처리하여 팝업, 별도 로그 생성 없음)
 > 중복 검사의 시점 - 지문/얼굴/카드 추가 직후에 검사
 > 중복 검사의 종료 - Matching TimeOut을 무시하고, 등록된 1:N 사용자에 대해서 모두 검사하고, 처음 매칭된 사용자의 지문/얼굴에 대해서 검색이 되면 중복 팝업 후 검사 중지
 > 서버 매칭 사용 시에도 장치에 지문/얼굴/카드 등록 시 중복 검사 동작
 > 서버를 통해 장치에 사용자 전송 시 Card에 대해서 중복 체크 하도록 개선(BAS-509 참조){color}
 ** {color:#59afe1}1:N / 1:1 중복 검사 -> 1:1설정 사용 시 1:N까지는 중복 검사 동작, 1:1이 되는 순간 중복 검사 안함, 1:N에 대해서만 중복 검사 지원{color}
 ** 미지원 FW -> 지원 FW로 Upgrade시 "비활성화"로 동작(지원 FW로 Upgrade 후 초기화 혹은 메뉴에서 설정을 해주어야 이후 부터는 Default가 "활성화"로 동작됨)
 ** 해당 등록 실패 로그를 구분할 수 있도록 별도 로그 생성 (서버에서 해당 시도 여부를 추적할 수 있어야 함) 
{panel:title=Event Code}
||*||Main||Sub||
|중복실패|BS2_EVENT_USER_DUPLICATE_CREDENTIAL|BS2_SUB_EVENT_CREDENTIAL_[CARD\|FINGER\|FACE]|
{panel} 
 {color:#59afe1}=> User ID / 중복관련 문구가 Event Log로 생성 (BSFingerprintConfig, BS2FaceConfig 구조체 변경){color} 
 {color:#59afe1}=> Card : 기존 부터 중복 체크 지원(별도 UI 상 설정 항목 없음, 기존 구조체 유지 및 Event Log만 추가){color} 
** 장치 문구 표시        
||{color:#d04437}중복 지문, 얼굴, 카드 검사 기능{color}||{color:#8eb021}EN{color}||{color:#8eb021}KO{color}||
|중복 표시 문구|Duplicate Fingerprint (User ID)
 Duplicate Face (User ID)
 Duplicate Card (User ID)|중복된 지문 (사용자 ID)
 중복된 얼굴 (사용자 ID)
 중복된 카드 (사용자 ID)| 
 
 * 서버/클라이언트
 ** 장치 설정
 *** 지문, 얼굴 지원 장치의 상세 설정 메뉴에서 중복 검사 지원 활성화/비활성화 선택 지원 (지원 FW부터는 활성화 Default)
 {color:#59afe1}*** 미지원 FW 지원 방식 논의 필요(BioStar는 활성화되어 있고, 중복검사 미지원 FW가 연결된 상태에서 해당 장치를 이용해 중복검사를 할 경우에 대한 케이스)
 => 서버와 장치는 별개로 동작. 따라서 서버는 DB에 저장된 정보로 체크해 중복여부 판단함.{color}
 ** 글로벌 설정
 *** 지문, 얼굴 중복 각각에 대해 중복 검사 활성화, 비활성화 선택 지원  (Default는 비활성화)
 **** 지문
 ***** 사용자 수에 따라 Security Level 자동 조절 지원
 **** 얼굴
 ***** DB내 사용자의 얼굴 수 3,000 명을 초과하는 경우 중복 검사 미지원
 ***** 최대 3000명까지 중복 검사 지원하며, 활성화시 이러한 메시지 표시 
 ***** Security Level은 5백만 분의 1로 중복 검사 
 ** 사용자 등록 
 *** 중복 발생 시, Matching 되는 사용자 ID 및 이름 표시 및 등록 거부
 *** 해당 시도에 대해, Audit Trail에서 추적 가능하도록 지원 
============================================================

■ 테스트 스텝

[Step 1]
스텝 (Step)
1. User> Add User
2. 기 등록된 Finger/Face/Card 입력 > Apply

데이터 (Data)
지문/카드/얼굴 등록 가능 장치
> 1:N, 1:1 Full Enroll

예상 결과 (Expected Result)
1. 기 등록된 동일 사용자가 아닌 다른 사용자에 지문/얼굴/카드 등록 시 중복으로 등록 실패가 되어야 한다.
||{color:#d04437}중복 지문, 얼굴, 카드 검사 기능{color}||{color:#8eb021}EN{color}||{color:#8eb021}KO{color}||
|중복 표시 문구|Duplicate Fingerprint (User ID)
 Duplicate Face (User ID)
 Duplicate Card (User ID)|중복된 지문 (사용자 ID)
 중복된 얼굴 (사용자 ID)
 중복된 카드 (사용자 ID)| 
2. 중복검사는 1:N 까지 지원한다.
> 1:1 -> 1:N 까지 지원
------------------------------------------------------------
[Step 2]
스텝 (Step)
1. User> Add User> Card
2. Scan Card

데이터 (Data)
카드 등록 가능 장치
> 1:N, 1:1 Full Enroll

CSN Card
> Mifare, EM, Felica
Smart Card
> Iclass/Mifare/Mobile
Wiegand Card
> HID 카드(Prox, iClass)

예상 결과 (Expected Result)
1. 동일 사용자에 기 등록된 카드 등록 시 기존 처럼  중복 카드 팝업으로 실패가 되고, 별도 로그 미생성된다.
> Duplicate Card, Card is duplicated, Card is already enroll - 추후 정리
2. 다른 사용자에 기 등록된 카드 등록 시 중복으로 실패가 되고, 로그 생성 된다.
> Duplicate Card(User ID), 중복된 카드(사용자 ID)
------------------------------------------------------------
[Step 3]
스텝 (Step)
1. User> Add User> Face
2. Scan Face

데이터 (Data)
얼굴 등록 가능 장치
> 1:N, 1:1 Full Enroll

예상 결과 (Expected Result)
1. 동일 사용자에 기 등록된 얼굴 등록 시 아래 처럼 등록이 된다.
> FS2 - 5개
> F2 - 2개
2. 다른 사용자에 기 등록된 얼굴 등록 시 중복으로 실패가 되고, 로그 생성 된다.
> Duplicate Face(User ID), 중복된 얼굴(사용자 ID)
------------------------------------------------------------
[Step 4]
스텝 (Step)
1.User > Add User
2.Scan Finger

데이터 (Data)
지문 등록 가능 장치
> 1:N, 1:1 Full Enroll

예상 결과 (Expected Result)
1. 동일 사용자에 기 등록된 지문 등록 시 기존 처럼 10개 까지 등록이 된다.
2. 다른 사용자에 기 등록된 지문 등록 시 중복으로 실패가 되고, 로그 생성 된다.
> Duplicate Finger(User ID), 중복된 지문(사용자 ID)
------------------------------------------------------------
[Step 5]
스텝 (Step)
0. BioStar/SDK > User Enroll
1. User> Add User
2. 기 등록된 Finger/Face/Card 입력 > Apply

데이터 (Data)
1:N, 1:1 User Transfer
> Finger, Face, Card
> 1:N Max
> 1:1 Max

예상 결과 (Expected Result)
1. 기 등록된 동일 사용자가 아닌 다른 사용자에 지문/얼굴/카드 등록 시 중복으로 등록 실패가 되어야 한다.
> 1:N Max 초과 시 등록 실패는 기존 처럼 동작
------------------------------------------------------------
[Step 6]
스텝 (Step)
1. User> Add User
2. 기 등록된 Finger/Face/Card 입력 > Apply

데이터 (Data)
1:N, 1:1 Full Enroll
> Matching Timeout 무시
> 1:N 수 만큼 중복 검사/1:1 시점에서는 중복 검사 안함

예상 결과 (Expected Result)
1. 중복 검사의 종료 시 동작은 아래와 같다.
>  Matching TimeOut을 무시하고, 등록된 1:N 사용자에 대해서 모두 검사하고, 처음 매칭된 사용자의 지문/얼굴에 대해서 검색이 되면 중복 팝업 후 검사 중지
------------------------------------------------------------
